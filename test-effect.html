<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Hiệu Ứng Tia Sét</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f3f4f6;
            padding: 40px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            position: relative;
            z-index: 1;
        }

        .card:hover {
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-5px);
        }

        .card-image {
            height: 180px;
            overflow: hidden;
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }
        
        .card:hover .card-image img {
            transform: scale(1.05);
        }

        .card-content {
            padding: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .card-price {
            font-size: 20px;
            font-weight: bold;
            color: #2563eb;
            margin-top: 10px;
        }

        .discount {
            color: #999;
            text-decoration: line-through;
            font-size: 14px;
            margin-left: 5px;
        }

        .tag {
            display: inline-block;
            background-color: #eef2ff;
            color: #4f46e5;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .btn {
            background-color: #2563eb;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background-color: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3);
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        /* Hiệu ứng viền tia sét */
        .lightning-border {
            position: relative;
            z-index: 1;
        }

        .lightning-border::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 12px;
            padding: 2px;
            background: linear-gradient(
                45deg,
                #00c6ff,
                #0072ff,
                transparent 60%
            );
            -webkit-mask: 
                linear-gradient(#fff 0 0) content-box, 
                linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
            z-index: 5;
        }

        /* Hiệu ứng tia sét di chuyển dọc theo viền */
        .lightning-effect {
            position: relative;
            overflow: hidden;
        }

        .lightning-effect .web-container {
            position: absolute;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
            z-index: 4;
        }

        .lightning-effect .web-line {
            position: absolute;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(100, 210, 255, 0.45) 40%, 
                rgba(50, 180, 255, 0.55) 50%,
                rgba(100, 210, 255, 0.45) 60%,
                transparent);
            height: 1px;
            transform-origin: left center;
            opacity: 0;
            animation: webLineOpacity 5s ease-in-out infinite;
            border-radius: 50%;
            pointer-events: none;
            box-shadow: 0 0 2px rgba(80, 190, 255, 0.4);
            transition: left 0.5s ease-out, top 0.5s ease-out, width 0.5s ease-out, transform 0.5s ease-out, opacity 0.5s ease-out;
        }

        /* Đốm sáng di chuyển random */
        .lightning-effect .floating-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.9) 20%, rgba(0, 198, 255, 0.7) 70%);
            box-shadow: 
                0 0 6px 2px rgba(0, 198, 255, 0.5),
                0 0 10px 4px rgba(0, 114, 255, 0.3);
            opacity: 0;
            z-index: 6;
            pointer-events: none;
        }

        .lightning-effect .p1 {
            top: 5px;
            left: calc(var(--random-position1, 10%) + var(--random-offset1, 20px));
            animation: floatingParticle1 3.8s ease-in-out infinite;
            animation-delay: calc(var(--random-delay1, 0.2s));
        }

        .lightning-effect .p2 {
            top: 5px;
            right: calc(var(--random-position2, 30%) + var(--random-offset2, 20px));
            animation: floatingParticle2 4.1s ease-in-out infinite;
            animation-delay: calc(var(--random-delay2, 1.5s));
        }

        .lightning-effect .p3 {
            top: calc(var(--random-position3, 20%) + var(--random-offset3, 15px));
            right: 5px;
            animation: floatingParticle3 3.9s ease-in-out infinite;
            animation-delay: calc(var(--random-delay3, 0.7s));
        }

        .lightning-effect .p4 {
            bottom: calc(var(--random-position4, 40%) + var(--random-offset4, 15px));
            right: 5px;
            animation: floatingParticle4 3.4s ease-in-out infinite;
            animation-delay: calc(var(--random-delay4, 1.1s));
        }

        .lightning-effect .p5 {
            bottom: 5px;
            right: calc(var(--random-position5, 20%) + var(--random-offset5, 20px));
            animation: floatingParticle5 3.7s ease-in-out infinite;
            animation-delay: calc(var(--random-delay5, 0.5s));
        }

        .lightning-effect .p6 {
            bottom: 5px;
            left: calc(var(--random-position6, 30%) + var(--random-offset6, 20px));
            animation: floatingParticle6 4.2s ease-in-out infinite;
            animation-delay: calc(var(--random-delay6, 0.3s));
        }

        .lightning-effect .p7 {
            bottom: calc(var(--random-position7, 35%) + var(--random-offset7, 15px));
            left: 5px;
            animation: floatingParticle7 4.0s ease-in-out infinite;
            animation-delay: calc(var(--random-delay7, 1.8s));
        }

        .lightning-effect .p8 {
            top: calc(var(--random-position8, 30%) + var(--random-offset8, 15px));
            left: 5px;
            animation: floatingParticle8 3.6s ease-in-out infinite;
            animation-delay: calc(var(--random-delay8, 0.9s));
        }

        @keyframes floatingParticle1 {
            0% { opacity: 0; transform: translate(0, 0); }
            3% { opacity: 0.3; }
            8% { opacity: 0.9; }
            15% { transform: translate(calc(35% + var(--random-x1, 5px)), calc(var(--random-y1, 3px))); }
            30% { transform: translate(calc(70% + var(--random-x1, 5px)), calc(var(--random-y1, 5px))); }
            50% { opacity: 0.9; transform: translate(calc(100% + var(--random-x1, 0px)), calc(var(--random-y1, 0px))); }
            70% { opacity: 0.7; transform: translate(calc(70% + var(--random-x1, 8px)), calc(-1 * var(--random-y1, 5px))); }
            90% { transform: translate(calc(30% + var(--random-x1, 0px)), calc(-1 * var(--random-y1, 8px))); opacity: 0.3; }
            100% { opacity: 0; transform: translate(0, 0); }
        }

        @keyframes floatingParticle2 {
            0% { opacity: 0; transform: translate(0, 0); }
            3% { opacity: 0.3; }
            8% { opacity: 0.9; }
            25% { transform: translate(calc(var(--random-x2, -5px)), calc(30% + var(--random-y2, 5px))); }
            45% { transform: translate(calc(var(--random-x2, -8px)), calc(60% + var(--random-y2, 8px))); }
            65% { opacity: 0.9; transform: translate(calc(var(--random-x2, -5px)), calc(85% + var(--random-y2, 10px))); }
            85% { opacity: 0.6; transform: translate(calc(var(--random-x2, -10px)), calc(110% + var(--random-y2, 5px))); }
            95% { transform: translate(calc(var(--random-x2, -5px)), calc(130% + var(--random-y2, 10px))); opacity: 0.3; }
            100% { opacity: 0; transform: translate(0, 0); }
        }

        @keyframes floatingParticle3 {
            0% { opacity: 0; transform: translate(0, 0); }
            3% { opacity: 0.3; }
            6% { opacity: 0.9; }
            20% { transform: translate(calc(var(--random-x3, -5px)), calc(25% + var(--random-y3, 5px))); }
            40% { opacity: 0.9; transform: translate(calc(var(--random-x3, -8px)), calc(55% + var(--random-y3, 10px))); }
            65% { opacity: 0.7; transform: translate(calc(var(--random-x3, -12px)), calc(75% + var(--random-y3, 15px))); }
            90% { transform: translate(calc(var(--random-x3, -15px)), calc(105% + var(--random-y3, 5px))); opacity: 0.3; }
            100% { opacity: 0; transform: translate(0, 0); }
        }

        @keyframes floatingParticle4 {
            0% { opacity: 0; transform: translate(0, 0); }
            4% { opacity: 0.3; }
            8% { opacity: 0.9; }
            25% { transform: translate(calc(-35% - var(--random-x4, 5px)), calc(25% + var(--random-y4, 5px))); }
            50% { opacity: 0.9; transform: translate(calc(-65% - var(--random-x4, 10px)), calc(40% + var(--random-y4, 10px))); }
            75% { opacity: 0.7; transform: translate(calc(-95% - var(--random-x4, 5px)), calc(60% + var(--random-y4, 5px))); }
            92% { transform: translate(calc(-125% - var(--random-x4, 10px)), calc(45% + var(--random-y4, 0px))); opacity: 0.3; }
            100% { opacity: 0; transform: translate(0, 0); }
        }

        @keyframes floatingParticle5 {
            0% { opacity: 0; transform: translate(0, 0); }
            3% { opacity: 0.3; }
            7% { opacity: 0.9; }
            25% { transform: translate(calc(-35% - var(--random-x5, 5px)), calc(var(--random-y5, 0px))); }
            45% { transform: translate(calc(-65% - var(--random-x5, 10px)), calc(var(--random-y5, 0px))); }
            65% { opacity: 0.9; transform: translate(calc(-95% - var(--random-x5, 15px)), calc(var(--random-y5, 0px))); }
            85% { opacity: 0.6; transform: translate(calc(-125% - var(--random-x5, 5px)), calc(var(--random-y5, 0px))); }
            95% { transform: translate(calc(-150% - var(--random-x5, 10px)), calc(var(--random-y5, 0px))); opacity: 0.3; }
            100% { opacity: 0; transform: translate(0, 0); }
        }

        @keyframes floatingParticle6 {
            0% { opacity: 0; transform: translate(0, 0); }
            3% { opacity: 0.3; }
            6% { opacity: 0.9; }
            25% { transform: translate(calc(-25% - var(--random-x6, 8px)), calc(-25% - var(--random-y6, 5px))); }
            45% { transform: translate(calc(-45% - var(--random-x6, 12px)), calc(-55% - var(--random-y6, 10px))); }
            65% { opacity: 0.9; transform: translate(calc(-75% - var(--random-x6, 15px)), calc(-85% - var(--random-y6, 15px))); }
            85% { opacity: 0.6; transform: translate(calc(-105% - var(--random-x6, 5px)), calc(-115% - var(--random-y6, 5px))); }
            95% { transform: translate(calc(-135% - var(--random-x6, 10px)), calc(-130% - var(--random-y6, 10px))); opacity: 0.3; }
            100% { opacity: 0; transform: translate(0, 0); }
        }

        @keyframes floatingParticle7 {
            0% { opacity: 0; transform: translate(0, 0); }
            3% { opacity: 0.3; }
            5% { opacity: 0.9; }
            20% { transform: translate(calc(var(--random-x7, 0px)), calc(-30% - var(--random-y7, 5px))); }
            40% { opacity: 0.9; transform: translate(calc(var(--random-x7, 0px)), calc(-60% - var(--random-y7, 10px))); }
            65% { opacity: 0.7; transform: translate(calc(var(--random-x7, 0px)), calc(-85% - var(--random-y7, 15px))); }
            90% { transform: translate(calc(var(--random-x7, 0px)), calc(-115% - var(--random-y7, 5px))); opacity: 0.3; }
            100% { opacity: 0; transform: translate(0, 0); }
        }

        @keyframes floatingParticle8 {
            0% { opacity: 0; transform: translate(0, 0); }
            3% { opacity: 0.3; }
            7% { opacity: 0.9; }
            25% { transform: translate(calc(35% + var(--random-x8, 5px)), calc(-20% - var(--random-y8, 5px))); }
            45% { opacity: 0.9; transform: translate(calc(75% + var(--random-x8, 10px)), calc(-10% - var(--random-y8, 2px))); }
            70% { opacity: 0.7; transform: translate(calc(105% + var(--random-x8, 5px)), calc(var(--random-y8, 0px))); }
            90% { transform: translate(calc(135% + var(--random-x8, 10px)), calc(15% + var(--random-y8, 5px))); opacity: 0.3; }
            100% { opacity: 0; transform: translate(0, 0); }
        }

        /* Hiệu ứng ánh sáng phát ra từ bên trong */
        .lightning-item {
            position: relative;
            overflow: hidden;
        }

        /* Loại bỏ hiệu ứng inner-glow khi hover */
        .lightning-item .inner-glow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(
                circle at 30% 70%,
                rgba(0, 198, 255, 0.2),
                transparent 70%
            );
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 3;
        }

        /* Loại bỏ hiệu ứng chớp sáng khi hover */
        .lightning-item .flash {
            position: absolute;
            inset: 0;
            background-color: rgba(0, 150, 255, 0.15);
            opacity: 0;
            z-index: 2;
            pointer-events: none;
        }

        @keyframes flash {
            0% { opacity: 0.6; }
            100% { opacity: 0; }
        }

        /* Hiệu ứng góc trang trí */
        .lightning-item .corner {
            position: absolute;
            width: 40px;
            height: 40px;
            pointer-events: none;
            opacity: 0;
            z-index: 4;
            transition: all 0.4s ease-out;
        }

        .lightning-item .corner-tl {
            top: 0;
            left: 0;
            border-top: 3px solid transparent;
            border-left: 3px solid transparent;
            border-top-left-radius: 8px;
            background: linear-gradient(135deg, #00c6ff, transparent 80%);
            filter: drop-shadow(0 0 4px rgba(0, 198, 255, 0.8));
        }

        .lightning-item .corner-tr {
            top: 0;
            right: 0;
            border-top: 3px solid transparent;
            border-right: 3px solid transparent;
            border-top-right-radius: 8px;
            background: linear-gradient(225deg, #0072ff, transparent 80%);
            filter: drop-shadow(0 0 4px rgba(0, 114, 255, 0.8));
        }

        .lightning-item .corner-bl {
            bottom: 0;
            left: 0;
            border-bottom: 3px solid transparent;
            border-left: 3px solid transparent;
            border-bottom-left-radius: 8px;
            background: linear-gradient(45deg, #0072ff, transparent 80%);
            filter: drop-shadow(0 0 4px rgba(0, 114, 255, 0.8));
        }

        .lightning-item .corner-br {
            bottom: 0;
            right: 0;
            border-bottom: 3px solid transparent;
            border-right: 3px solid transparent;
            border-bottom-right-radius: 8px;
            background: linear-gradient(315deg, #00c6ff, transparent 80%);
            filter: drop-shadow(0 0 4px rgba(0, 198, 255, 0.8));
        }

        /* Discount tag */
        .discount-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(239, 68, 68, 0.9);
            color: white;
            font-size: 12px;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 4px;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Hiệu ứng sao băng */
        .card {
            overflow: hidden;
        }
        
        .shooting-star {
            position: absolute;
            width: 2px;
            height: 100px;
            background: linear-gradient(180deg, 
                rgba(255, 255, 255, 0), 
                rgba(255, 255, 255, 0.5) 20%, 
                rgba(70, 200, 255, 0.6) 40%, 
                rgba(30, 100, 255, 0.3));
            transform: rotate(15deg);
            filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.5));
            opacity: 0;
            z-index: 20;
            pointer-events: none;
            will-change: transform, opacity;
        }
        
        .shooting-star::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: -1px;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 0 8px 1px rgba(70, 200, 255, 0.6);
        }
        
        .card .shooting-star-1 {
            top: -60px;
            left: 30%;
            animation: shootingStar1 6s ease-in-out infinite;
            animation-delay: 2s;
        }
        
        .card .shooting-star-2 {
            top: -80px;
            left: 60%;
            animation: shootingStar2 8s ease-in-out infinite;
            animation-delay: 5s;
        }
        
        .card .shooting-star-3 {
            top: -70px;
            left: 20%;
            animation: shootingStar3 7s ease-in-out infinite;
            animation-delay: 1s;
        }
        
        @keyframes shootingStar1 {
            0%, 100% { 
                opacity: 0; 
                transform: rotate(15deg) translateY(0);
            }
            10%, 15% { 
                opacity: 1; 
            }
            30% { 
                opacity: 0; 
                transform: rotate(15deg) translateY(300px);
            }
        }
        
        @keyframes shootingStar2 {
            0%, 100% { 
                opacity: 0; 
                transform: rotate(-10deg) translateY(0);
            }
            10%, 15% { 
                opacity: 1; 
            }
            35% { 
                opacity: 0; 
                transform: rotate(-10deg) translateY(350px);
            }
        }
        
        @keyframes shootingStar3 {
            0%, 100% { 
                opacity: 0; 
                transform: rotate(25deg) translateY(0);
            }
            10%, 15% { 
                opacity: 1; 
            }
            25% { 
                opacity: 0; 
                transform: rotate(25deg) translateY(250px);
            }
        }

        @keyframes webLineOpacity {
            0%, 100% { opacity: 0; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test Hiệu Ứng Viền Tia Sét</h1>
        
        <div class="grid">
            <!-- Item với hiệu ứng tia sét -->
            <div class="card lightning-border lightning-effect lightning-item">
                <div class="floating-particle p1"></div>
                <div class="floating-particle p2"></div>
                <div class="floating-particle p3"></div>
                <div class="floating-particle p4"></div>
                <div class="floating-particle p5"></div>
                <div class="floating-particle p6"></div>
                <div class="floating-particle p7"></div>
                <div class="floating-particle p8"></div>
                <div class="inner-glow"></div>
                <div class="flash"></div>
                <div class="corner corner-tl"></div>
                <div class="corner corner-tr"></div>
                <div class="corner corner-bl"></div>
                <div class="corner corner-br"></div>
                <!-- Thêm sao băng -->
                <div class="shooting-star shooting-star-1"></div>
                <div class="shooting-star shooting-star-2"></div>
                <div class="shooting-star shooting-star-3"></div>
                <div class="card-image">
                    <div class="discount-tag">-30%</div>
                    <img src="https://via.placeholder.com/300x200" alt="Game Account">
                </div>
                <div class="card-content">
                    <div class="tag">PUBG Mobile</div>
                    <div class="card-title">Tài khoản VIP Premium với nhiều skin</div>
                    <p>Tài khoản VIP với đầy đủ trang bị và nhiều skin hiếm</p>
                    <div class="card-footer">
                        <div class="card-price">
                            350.000đ
                            <span class="discount">500.000đ</span>
                        </div>
                        <button class="btn">Chi tiết</button>
                    </div>
                </div>
            </div>

            <!-- Item không có hiệu ứng tia sét -->
            <div class="card">
                <div class="card-image">
                    <img src="https://via.placeholder.com/300x200" alt="Game Account">
                </div>
                <div class="card-content">
                    <div class="tag">Free Fire</div>
                    <div class="card-title">Tài khoản cơ bản full skin</div>
                    <p>Tài khoản với đầy đủ trang bị và skin thường</p>
                    <div class="card-footer">
                        <div class="card-price">
                            200.000đ
                        </div>
                        <button class="btn">Chi tiết</button>
                    </div>
                </div>
            </div>

            <!-- Item với hiệu ứng tia sét -->
            <div class="card lightning-border lightning-effect lightning-item">
                <div class="floating-particle p1"></div>
                <div class="floating-particle p2"></div>
                <div class="floating-particle p3"></div>
                <div class="floating-particle p4"></div>
                <div class="floating-particle p5"></div>
                <div class="floating-particle p6"></div>
                <div class="floating-particle p7"></div>
                <div class="floating-particle p8"></div>
                <div class="inner-glow"></div>
                <div class="flash"></div>
                <div class="corner corner-tl"></div>
                <div class="corner corner-tr"></div>
                <div class="corner corner-bl"></div>
                <div class="corner corner-br"></div>
                <!-- Thêm sao băng -->
                <div class="shooting-star shooting-star-1"></div>
                <div class="shooting-star shooting-star-2"></div>
                <div class="shooting-star shooting-star-3"></div>
                <div class="card-image">
                    <div class="discount-tag">-25%</div>
                    <img src="https://via.placeholder.com/300x200" alt="Game Account">
                </div>
                <div class="card-content">
                    <div class="tag">Liên Quân Mobile</div>
                    <div class="card-title">Tài khoản VIP cao cấp - Nhiều tướng SS+</div>
                    <p>Tài khoản với đầy đủ tướng và trang phục hiếm</p>
                    <div class="card-footer">
                        <div class="card-price">
                            750.000đ
                            <span class="discount">1.000.000đ</span>
                        </div>
                        <button class="btn">Chi tiết</button>
                    </div>
                </div>
            </div>

            <!-- Item không có hiệu ứng tia sét -->
            <div class="card">
                <div class="card-image">
                    <img src="https://via.placeholder.com/300x200" alt="Game Account">
                </div>
                <div class="card-content">
                    <div class="tag">Genshin Impact</div>
                    <div class="card-title">Tài khoản AR55 - Nhiều nhân vật 5 sao</div>
                    <p>Tài khoản có nhiều nhân vật 5 sao và vũ khí hiếm</p>
                    <div class="card-footer">
                        <div class="card-price">
                            450.000đ
                        </div>
                        <button class="btn">Chi tiết</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Script để thêm các giá trị ngẫu nhiên cho các hạt sáng - mỗi hạt hoạt động độc lập
        function initRandomEffects() {
            // Lấy tất cả các thẻ có class lightning-effect
            const items = document.querySelectorAll('.lightning-effect');
            
            // Với mỗi thẻ, thêm các biến CSS tùy chỉnh ngẫu nhiên
            items.forEach(item => {
                // Lấy các hạt trong thẻ
                const particles = item.querySelectorAll('.floating-particle');
                
                // Chọn chính xác 1 hạt để cập nhật
                const randomIndex = Math.floor(Math.random() * particles.length);
                const particle = particles[randomIndex];
                const particleIndex = randomIndex + 1; // p1, p2, ..., p8
                
                // Bỏ qua nếu hạt đang trong giai đoạn animation
                if (particle.dataset.updating === "true") {
                    return;
                }
                
                // Đánh dấu hạt đang được cập nhật
                particle.dataset.updating = "true";
                
                // Áp dụng fade-out từ từ
                if (parseFloat(window.getComputedStyle(particle).opacity) > 0.1) {
                    particle.style.transition = 'opacity 1.5s ease-out';
                    particle.style.opacity = '0';
                    
                    // Cập nhật lại các thông số sau khi fade-out
                    setTimeout(() => {
                        updateParticleProperties(particle, particleIndex, item);
                    }, 1600); // Đợi lâu hơn để đảm bảo hiệu ứng fade-out hoàn tất
                } else {
                    // Nếu hạt đã ẩn, cập nhật ngay
                    updateParticleProperties(particle, particleIndex, item);
                }
            });
        }
        
        // Hàm cập nhật thuộc tính cho một hạt
        function updateParticleProperties(particle, particleIndex, item) {
            // Đảm bảo hạt không di chuyển ra ngoài phạm vi của card
            const cardWidth = item.offsetWidth;
            const cardHeight = item.offsetHeight;
            
            // Giới hạn các giá trị random để hạt không di chuyển quá xa
            const maxOffset = Math.min(20, cardWidth * 0.1, cardHeight * 0.1);
            const randomOffset = Math.floor(Math.random() * maxOffset);
            
            // Delay ngẫu nhiên
            const randomDelay = (Math.random() * 2).toFixed(2);
            item.style.setProperty(`--random-delay${particleIndex}`, `${randomDelay}s`);
            
            // Giới hạn vị trí tùy chọn
            const maxPosition = 40; // Phần trăm
            const randomPosition = Math.floor(Math.random() * maxPosition);
            
            // Giới hạn các giá trị X, Y cho đường đi
            const maxDelta = Math.min(20, cardWidth * 0.05, cardHeight * 0.05);
            const randomX = Math.floor(Math.random() * maxDelta);
            const randomY = Math.floor(Math.random() * maxDelta);
            
            // Cập nhật các thuộc tính CSS với giá trị đã giới hạn
            item.style.setProperty(`--random-offset${particleIndex}`, `${randomOffset}px`);
            item.style.setProperty(`--random-position${particleIndex}`, `${randomPosition}%`);
            item.style.setProperty(`--random-x${particleIndex}`, `${randomX}px`);
            item.style.setProperty(`--random-y${particleIndex}`, `${randomY}px`);
            
            // Reset animation
            // Lưu lại class hiện tại
            const currentClass = particle.className;
            
            // Tạm thời xóa class p[1-8] để reset animation
            particle.className = currentClass.replace(/p[1-8]/, '');
            
            // Đặt lại opacity
            particle.style.opacity = '0';
            
            // Thêm class lại sau một khoảng thời gian để bắt đầu animation mới
            setTimeout(() => {
                particle.className = currentClass;
                
                // Áp dụng transition cho fade-in từ từ
                setTimeout(() => {
                    // Thay đổi transition để xuất hiện từ từ
                    particle.style.transition = 'opacity 1.8s ease-in';
                    
                    // Độ sáng ngẫu nhiên
                    const randomBrightness = 0.7 + Math.random() * 0.3;
                    particle.style.opacity = randomBrightness.toString();
                    
                    // Xóa trạng thái đang cập nhật khi animation đã bắt đầu
                    setTimeout(() => {
                        particle.dataset.updating = "false";
                    }, 500);
                }, 100);
            }, 50);
        }
        
        // Tạo các đường mạng nhện kết nối
        function createWebLines() {
            const items = document.querySelectorAll('.lightning-effect');
            
            items.forEach(item => {
                // Tạo container cho các đường mạng nhện
                let webContainer = item.querySelector('.web-container');
                if (!webContainer) {
                    webContainer = document.createElement('div');
                    webContainer.className = 'web-container';
                    item.appendChild(webContainer);
                }
                
                // Xóa các đường cũ
                webContainer.innerHTML = '';
                
                // Lấy các hạt
                const particles = item.querySelectorAll('.floating-particle');
                if (particles.length < 2) return;
                
                // Tạo mảng lưu vị trí các hạt có opacity > 0
                const activeParticles = [];
                particles.forEach(particle => {
                    if (parseFloat(window.getComputedStyle(particle).opacity) > 0.1) {
                        // Lấy vị trí tương đối với card
                        const rect = particle.getBoundingClientRect();
                        const itemRect = item.getBoundingClientRect();
                        
                        // Kiểm tra xem hạt có nằm trong card không
                        if (rect.left >= itemRect.left && rect.right <= itemRect.right &&
                            rect.top >= itemRect.top && rect.bottom <= itemRect.bottom) {
                            activeParticles.push({
                                x: rect.left - itemRect.left + rect.width/2,
                                y: rect.top - itemRect.top + rect.height/2,
                                element: particle,
                                id: particle.className.match(/p(\d+)/)[1] // Lấy số hạt (p1, p2, ...)
                            });
                        }
                    }
                });
                
                // Nếu có ít nhất 2 hạt đang hiển thị, tạo các đường kết nối
                if (activeParticles.length >= 2) {
                    // Giới hạn số lượng đường kết nối: mỗi hạt kết nối với tối đa 3 hạt khác
                    const connections = new Map(); // Lưu trữ các kết nối đã tạo
                    
                    // Tạo các đường ngẫu nhiên giữa các hạt
                    for (let i = 0; i < activeParticles.length; i++) {
                        // Mỗi hạt chỉ kết nối tối đa với 3 hạt khác
                        if (!connections.has(i)) {
                            connections.set(i, []);
                        }
                        
                        if (connections.get(i).length >= 3) {
                            continue; // Hạt này đã có đủ 3 kết nối
                        }
                        
                        // Tìm 3 hạt gần nhất để kết nối
                        const nearestParticles = findNearestParticles(activeParticles, i, connections);
                        
                        for (const j of nearestParticles) {
                            if (i === j) continue;
                            
                            // Tránh kết nối ngược lại
                            if (connections.has(j) && connections.get(j).includes(i)) {
                                continue;
                            }
                            
                            // Thêm kết nối vào danh sách
                            connections.get(i).push(j);
                            if (!connections.has(j)) {
                                connections.set(j, []);
                            }
                            connections.get(j).push(i);
                            
                            const start = activeParticles[i];
                            const end = activeParticles[j];
                            
                            createWebLine(start, end, webContainer, item);
                            
                            // Dừng nếu đã đủ 3 kết nối
                            if (connections.get(i).length >= 3) {
                                break;
                            }
                        }
                    }

                    // Thêm một vài kết nối ngẫu nhiên để tăng tính tự nhiên
                    if (activeParticles.length > 3) {
                        for (let i = 0; i < Math.min(3, activeParticles.length / 2); i++) {
                            const randomIndex1 = Math.floor(Math.random() * activeParticles.length);
                            const randomIndex2 = Math.floor(Math.random() * activeParticles.length);
                            
                            if (randomIndex1 !== randomIndex2) {
                                const start = activeParticles[randomIndex1];
                                const end = activeParticles[randomIndex2];
                                createWebLine(start, end, webContainer, item);
                            }
                        }
                    }
                }
            });
        }
        
        // Hàm tìm các hạt gần nhất
        function findNearestParticles(particles, currentIndex, connections) {
            const current = particles[currentIndex];
            
            // Tính khoảng cách đến các hạt khác
            const distances = [];
            for (let i = 0; i < particles.length; i++) {
                if (i === currentIndex) continue;
                
                // Không kết nối với hạt đã có đủ 3 kết nối
                if (connections.has(i) && connections.get(i).length >= 3) {
                    continue;
                }
                
                const other = particles[i];
                const distance = Math.sqrt(
                    Math.pow(other.x - current.x, 2) + 
                    Math.pow(other.y - current.y, 2)
                );
                
                distances.push({ index: i, distance });
            }
            
            // Sắp xếp theo khoảng cách tăng dần
            distances.sort((a, b) => a.distance - b.distance);
            
            // Trả về chỉ số của 3 hạt gần nhất
            return distances.slice(0, 3).map(d => d.index);
        }
        
        // Hàm tạo đường mạng nhện
        function createWebLine(start, end, container, item) {
            // Tính toán độ dài và góc của đường
            const length = Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2));
            const angle = Math.atan2(end.y - start.y, end.x - start.x) * 180 / Math.PI;
            
            // Tính độ mờ dựa trên độ mờ của các hạt
            const opacity1 = parseFloat(window.getComputedStyle(start.element).opacity);
            const opacity2 = parseFloat(window.getComputedStyle(end.element).opacity);
            const lineOpacity = Math.min(opacity1, opacity2) * 0.6; // Tăng từ 0.4 lên 0.6
            
            // Tạo đường
            const line = document.createElement('div');
            line.className = 'web-line';
            line.dataset.startId = start.id;
            line.dataset.endId = end.id;
            line.style.width = `${length}px`;
            line.style.left = `${start.x}px`;
            line.style.top = `${start.y}px`;
            line.style.transform = `rotate(${angle}deg)`;
            line.style.opacity = lineOpacity;
            
            // Thay đổi độ dày - mỏng nhưng sắc nét
            line.style.height = `${0.7 + Math.random() * 0.5}px`;
            
            // Điều chỉnh màu ngẫu nhiên - sắc nét hơn
            const hue = 190 + Math.floor(Math.random() * 30);
            const sat = 80 + Math.floor(Math.random() * 15); // Tăng saturation
            const light = 68 + Math.floor(Math.random() * 12); // Điều chỉnh lightness
            line.style.background = `linear-gradient(90deg, 
                transparent, 
                hsla(${hue}, ${sat}%, ${light}%, 0.45) 40%,
                hsla(${hue - 5}, ${sat + 10}%, ${light + 2}%, 0.55) 50%,
                hsla(${hue}, ${sat}%, ${light}%, 0.45) 60%,
                transparent)`;
            
            // Áp dụng animation delay ngẫu nhiên
            line.style.animationDelay = `${Math.random() * 5}s`;
            
            // Thêm hiệu ứng glow - sắc nét hơn
            line.style.boxShadow = `0 0 2px hsla(${hue}, ${sat}%, ${light}%, 0.4)`;

            // Thêm vào container
            container.appendChild(line);
            
            // Cập nhật vị trí đường khi hạt di chuyển
            updateWebLinePosition(line, start.element, end.element, item);
        }
        
        // Cập nhật vị trí đường mạng nhện khi các hạt di chuyển
        function updateWebLinePositions() {
            const items = document.querySelectorAll('.lightning-effect');
            
            items.forEach(item => {
                const webContainer = item.querySelector('.web-container');
                if (!webContainer) return;
                
                const webLines = webContainer.querySelectorAll('.web-line');
                webLines.forEach(line => {
                    const startId = line.dataset.startId;
                    const endId = line.dataset.endId;
                    
                    if (!startId || !endId) return;
                    
                    const startElement = item.querySelector(`.p${startId}`);
                    const endElement = item.querySelector(`.p${endId}`);
                    
                    if (startElement && endElement) {
                        updateWebLinePosition(line, startElement, endElement, item);
                    }
                });
            });
        }
        
        // Cập nhật vị trí và góc của đường mạng nhện
        function updateWebLinePosition(line, startElement, endElement, item) {
            const startOpacity = parseFloat(window.getComputedStyle(startElement).opacity);
            const endOpacity = parseFloat(window.getComputedStyle(endElement).opacity);
            
            // Chỉ hiển thị đường khi cả hai hạt đều hiển thị
            if (startOpacity > 0.1 && endOpacity > 0.1) {
                const startRect = startElement.getBoundingClientRect();
                const endRect = endElement.getBoundingClientRect();
                const itemRect = item.getBoundingClientRect();
                
                const startX = startRect.left - itemRect.left + startRect.width / 2;
                const startY = startRect.top - itemRect.top + startRect.height / 2;
                const endX = endRect.left - itemRect.left + endRect.width / 2;
                const endY = endRect.top - itemRect.top + endRect.height / 2;
                
                // Tính toán độ dài và góc giữa hai hạt
                const length = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
                const angle = Math.atan2(endY - startY, endX - startX) * 180 / Math.PI;
                
                // Áp dụng vào đường
                line.style.width = `${length}px`;
                line.style.left = `${startX}px`;
                line.style.top = `${startY}px`;
                line.style.transform = `rotate(${angle}deg)`;
                
                // Điều chỉnh độ mờ dựa trên độ mờ của hai hạt
                line.style.opacity = Math.min(startOpacity, endOpacity) * 0.4;
            } else {
                line.style.opacity = '0';
            }
        }
        
        // Gọi hàm sau khi trang tải xong
        document.addEventListener('DOMContentLoaded', function() {
            // Khởi tạo ban đầu
            initRandomEffects();
            createWebLines();
            
            // Sử dụng đệ quy thay vì setInterval để đảm bảo lần cập nhật trước hoàn tất
            function scheduleNextUpdate() {
                const randomTime = 1500 + Math.random() * 2000; // 1.5-3.5s
                setTimeout(() => {
                    initRandomEffects();
                    scheduleNextUpdate();
                }, randomTime);
            }
            
            // Lên lịch cập nhật mạng nhện
            function scheduleNextWebUpdate() {
                const randomTime = 50; // Tăng tần suất cập nhật (giảm từ 100ms xuống 50ms)
                setTimeout(() => {
                    updateWebLinePositions();
                    scheduleNextWebUpdate();
                }, randomTime);
            }
            
            // Tạo lại các đường mạng nhện theo định kỳ
            function scheduleWebLinesRecreation() {
                const randomTime = 3000 + Math.random() * 2000; // 3-5s
                setTimeout(() => {
                    createWebLines();
                    scheduleWebLinesRecreation();
                }, randomTime);
            }
            
            // Bắt đầu lịch trình cập nhật
            scheduleNextUpdate();
            scheduleNextWebUpdate();
            scheduleWebLinesRecreation();
        });
    </script>
</body>
</html>
